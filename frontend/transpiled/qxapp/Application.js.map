{
  "version": 3,
  "sources": [
    "/home/travis/build/ITISFoundation/osparc-simcore/services/web/client/source/class/qxapp/Application.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "application",
    "Standalone",
    "include",
    "locale",
    "MTranslation",
    "members",
    "__current",
    "main",
    "__preventAutofillBrowserSyles",
    "log",
    "appender",
    "Native",
    "window",
    "addEventListener",
    "e",
    "preventDefault",
    "returnValue",
    "core",
    "Environment",
    "get",
    "console",
    "debug",
    "qxapp",
    "dev",
    "fake",
    "srv",
    "restapi",
    "User",
    "Authentication",
    "auth",
    "Manager",
    "getInstance",
    "addListener",
    "__restart",
    "__initRouting",
    "__loadCommonCss",
    "urlFragment",
    "utils",
    "Utils",
    "parseURLFragment",
    "nav",
    "length",
    "cookie",
    "deleteCookie",
    "validateToken",
    "__loadMainPage",
    "__loadLoginPage",
    "params",
    "invitation",
    "code",
    "registered",
    "error",
    "isLogged",
    "isLoggedIn",
    "warn",
    "data",
    "role",
    "logout",
    "__disconnectWebSocket",
    "view",
    "LoginPage",
    "msg",
    "__loadView",
    "top",
    "bottom",
    "left",
    "right",
    "studyId",
    "__connectWebSocket",
    "desktop",
    "MainPage",
    "options",
    "assert",
    "doc",
    "getRoot",
    "hasChildren",
    "remove",
    "add",
    "history",
    "replaceState",
    "wrapper",
    "WebSocket",
    "connect",
    "disconnect",
    "stylesheet",
    "ui",
    "style",
    "Stylesheet",
    "bom",
    "client",
    "Browser",
    "getName",
    "getVersion",
    "addRule",
    "Engine",
    "commonCssUri",
    "util",
    "ResourceManager",
    "toUri",
    "module",
    "Css",
    "includeStylesheet",
    "Application"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* ************************************************************************\n\n   qxapp - the simcore frontend\n\n   https://osparc.io\n\n   Copyright:\n     2018 IT'IS Foundation, https://itis.swiss\n\n   License:\n     MIT: https://opensource.org/licenses/MIT\n\n   Authors:\n     * Odei Maiz (odeimaiz)\n     * Tobias Oetiker (oetiker)\n     * Pedro Crespo (pcrespov)\n\n************************************************************************ */\n\n/**\n * This is the main application class of \"qxapp\"\n *\n * @asset(qxapp/*)\n * @asset(common/common.css)\n */\n\nqx.Class.define(\"qxapp.Application\", {\n  extend: qx.application.Standalone,\n  include: [\n    qx.locale.MTranslation\n  ],\n\n  members:\n  {\n    __current: null,\n\n    /**\n     * This method contains the initial application code and gets called\n     * during startup of the application\n     */\n    main: function() {\n      // Call super class\n      this.base();\n      this.__preventAutofillBrowserSyles();\n\n      // Enable logging in debug variant\n      if (qx.core.Environment.get(\"qx.debug\")) {\n        // support native logging capabilities, e.g. Firebug for Firefox\n        qx.log.appender.Native;\n      }\n      // alert the users that they are about to navigate away\n      // from osparc. unfortunately it is not possible\n      // to provide our own message here\n      window.addEventListener(\"beforeunload\", e => {\n        // Cancel the event as stated by the standard.\n        e.preventDefault();\n        // Chrome requires returnValue to be set.\n        e.returnValue = \"\";\n      });\n      if (qx.core.Environment.get(\"dev.enableFakeSrv\")) {\n        console.debug(\"Fake server enabled\");\n        qxapp.dev.fake.srv.restapi.User;\n        qxapp.dev.fake.srv.restapi.Authentication;\n      }\n\n      // Setting up auth manager\n      qxapp.auth.Manager.getInstance().addListener(\"logout\", function() {\n        this.__restart();\n      }, this);\n\n      this.__initRouting();\n      this.__loadCommonCss();\n    },\n\n    __initRouting: function() {\n      const urlFragment = qxapp.utils.Utils.parseURLFragment();\n      if (urlFragment.nav && urlFragment.nav.length) {\n        if (urlFragment.nav[0] === \"study\" && urlFragment.nav.length > 1) {\n          // Route: /#/study/{id}\n          qxapp.utils.Utils.cookie.deleteCookie(\"user\");\n          qxapp.auth.Manager.getInstance().validateToken(() => this.__loadMainPage(urlFragment.nav[1]), this.__loadLoginPage, this);\n        } else if (urlFragment.nav[0] === \"registration\" && urlFragment.params && urlFragment.params.invitation) {\n          // Route: /#/registration/?invitation={token}\n          qxapp.utils.Utils.cookie.deleteCookie(\"user\");\n          this.__restart();\n        } else if (urlFragment.nav[0] === \"reset-password\" && urlFragment.params && urlFragment.params.code) {\n          // Route: /#/reset-password/?code={resetCode}\n          qxapp.utils.Utils.cookie.deleteCookie(\"user\");\n          this.__restart();\n        }\n      } else if (urlFragment.params) {\n        if (urlFragment.params.registered) {\n          // Route: /#/?registered=true\n          qxapp.utils.Utils.cookie.deleteCookie(\"user\");\n          this.__restart();\n        } else {\n          // this.load404();\n          console.error(\"URL fragment format not recognized.\");\n        }\n      } else {\n        this.__restart();\n      }\n    },\n\n    __restart: function() {\n      let isLogged = qxapp.auth.Manager.getInstance().isLoggedIn();\n\n      if (qx.core.Environment.get(\"dev.disableLogin\")) {\n        console.warn(\"Login page was disabled\", \"Starting main application ...\");\n        isLogged = true;\n      }\n\n      if (isLogged) {\n        this.__loadMainPage();\n      } else {\n        qxapp.auth.Manager.getInstance().validateToken(data => {\n          if (data.role === \"Guest\") {\n            // Logout a guest trying to access the Dashboard\n            qxapp.auth.Manager.getInstance().logout();\n          } else {\n            this.__loadMainPage();\n          }\n        }, this.__loadLoginPage, this);\n      }\n    },\n\n    __loadLoginPage: function() {\n      this.__disconnectWebSocket();\n      const view = new qxapp.auth.LoginPage();\n      view.addListener(\"done\", function(msg) {\n        this.__restart();\n      }, this);\n      this.__loadView(view, {\n        top: \"10%\",\n        bottom: 0,\n        left: 0,\n        right: 0\n      });\n    },\n\n    __loadMainPage: function(studyId) {\n      this.__connectWebSocket();\n      this.__loadView(new qxapp.desktop.MainPage(studyId), {\n        top: 0,\n        bottom: 0,\n        left: 0,\n        right: 0\n      });\n    },\n\n    __loadView: function(view, options) {\n      this.assert(view!==null);\n      // Update root document and currentness\n      let doc = this.getRoot();\n      if (doc.hasChildren() && this.__current) {\n        doc.remove(this.__current);\n        // this.__current.destroy();\n      }\n      doc.add(view, options);\n      this.__current = view;\n      // Clear URL\n      window.history.replaceState(null, \"\", \"/\");\n    },\n\n    /**\n     * Resets session and restarts\n    */\n    logout: function() {\n      qxapp.auth.Manager.getInstance().logout();\n      this.__restart();\n    },\n\n    __connectWebSocket: function() {\n      // open web socket\n      qxapp.wrapper.WebSocket.getInstance().connect();\n    },\n\n    __disconnectWebSocket: function() {\n      // open web socket\n      qxapp.wrapper.WebSocket.getInstance().disconnect();\n    },\n\n    __preventAutofillBrowserSyles: function() {\n      const stylesheet = qx.ui.style.Stylesheet.getInstance();\n      if (qx.bom.client.Browser.getName() === \"chrome\" && qx.bom.client.Browser.getVersion() >= 71) {\n        stylesheet.addRule(\n          \"input:-internal-autofill-previewed,\" +\n          \"input:-internal-autofill-selected,\" +\n          \"textarea:-internal-autofill-previewed,\" +\n          \"textarea:-internal-autofill-selected,\" +\n          \"select:-internal-autofill-previewed,\" +\n          \"select:-internal-autofill-selected\",\n\n          \"transition: background-color 0s linear 100000s, color 0s linear 100000s\"\n        );\n      } else if (qx.bom.client.Engine.getName() === \"webkit\") {\n        stylesheet.addRule(\n          \"input:-webkit-autofill,\" +\n          \"input:-webkit-autofill:hover,\" +\n          \"input:-webkit-autofill:focus,\" +\n          \"textarea:-webkit-autofill,\" +\n          \"textarea:-webkit-autofill:hover,\" +\n          \"textarea:-webkit-autofill:focus,\" +\n          \"select:-webkit-autofill,\" +\n          \"select:-webkit-autofill:hover,\" +\n          \"select:-webkit-autofill:focus\",\n\n          \"transition: background-color 0s linear 100000s, color 0s linear 100000s\"\n        );\n      }\n    },\n\n    __loadCommonCss: function() {\n      const commonCssUri = qx.util.ResourceManager.getInstance().toUri(\"common/common.css\");\n      qx.module.Css.includeStylesheet(commonCssUri);\n    }\n  }\n});\n"
  ]
}