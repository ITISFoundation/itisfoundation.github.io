{
  "version": 3,
  "sources": [
    "/home/travis/build/ITISFoundation/osparc-simcore/services/web/client/source/class/qxapp/file/FileLabelWithActions.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "ui",
    "core",
    "Widget",
    "construct",
    "layout",
    "HBox",
    "fileLabelWithActionsLayout",
    "_setLayout",
    "downloadBtn",
    "_createChildControlImpl",
    "addListener",
    "e",
    "__retrieveURLAndDownload",
    "deleteBtn",
    "__deleteFile",
    "__selectedLabel",
    "events",
    "members",
    "id",
    "control",
    "qxapp",
    "toolbar",
    "Label",
    "_add",
    "Button",
    "tr",
    "itemSelected",
    "selectedItem",
    "isFile",
    "__selection",
    "setValue",
    "getFileId",
    "__getItemSelected",
    "file",
    "FilesTree",
    "selection",
    "fileId",
    "fileName",
    "split",
    "length",
    "dataStore",
    "store",
    "Data",
    "getInstance",
    "addListenerOnce",
    "presignedLinkData",
    "getData",
    "console",
    "log",
    "presignedLink",
    "link",
    "fileNameFromLink",
    "utils",
    "Utils",
    "fileNameFromPresignedLink",
    "downloadLink",
    "download",
    "locationId",
    "getLocation",
    "getPresignedLink",
    "component",
    "message",
    "FlashMessenger",
    "logAs",
    "fireDataEvent",
    "deleteFile",
    "FileLabelWithActions"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* ************************************************************************\n\n   qxapp - the simcore frontend\n\n   https://osparc.io\n\n   Copyright:\n     2019 IT'IS Foundation, https://itis.swiss\n\n   License:\n     MIT: https://opensource.org/licenses/MIT\n\n   Authors:\n     * Odei Maiz (odeimaiz)\n\n************************************************************************ */\n\n/**\n * A HBox containing a text field, download button and delete button.\n *\n *   It is used together with a virtual tree of files where the selection is displayed\n * in the text field and the download and delete are related to that selection.\n * Download and deleted methods are also provided.\n * If a file is deleted it fires \"fileDeleted\" data event\n *\n * *Example*\n *\n * Here is a little example of how to use the widget.\n *\n * <pre class='javascript'>\n *   let hBox = new qxapp.file.FileLabelWithActions();\n *   this.getRoot().add(hBox);\n * </pre>\n */\n\nqx.Class.define(\"qxapp.file.FileLabelWithActions\", {\n  extend: qx.ui.core.Widget,\n\n  construct: function() {\n    this.base(arguments, new qx.ui.layout.HBox(5));\n\n    let fileLabelWithActionsLayout = new qx.ui.layout.HBox(5);\n    this._setLayout(fileLabelWithActionsLayout);\n\n    let downloadBtn = this._createChildControlImpl(\"downloadBtn\");\n    downloadBtn.addListener(\"execute\", e => {\n      this.__retrieveURLAndDownload();\n    }, this);\n\n    let deleteBtn = this._createChildControlImpl(\"deleteBtn\");\n    deleteBtn.addListener(\"execute\", e => {\n      this.__deleteFile();\n    }, this);\n\n    this.__selectedLabel = this._createChildControlImpl(\"selectedLabel\");\n  },\n\n  events: {\n    \"fileDeleted\": \"qx.event.type.Data\"\n  },\n\n  members: {\n    __selectedLabel: null,\n\n    _createChildControlImpl: function(id) {\n      let control;\n      switch (id) {\n        case \"selectedLabel\":\n          control = new qxapp.ui.toolbar.Label();\n          this._add(control);\n          break;\n        case \"downloadBtn\":\n          control = new qx.ui.toolbar.Button(this.tr(\"Download\"), \"@FontAwesome5Solid/cloud-download-alt/16\");\n          this._add(control);\n          break;\n        case \"deleteBtn\":\n          control = new qx.ui.toolbar.Button(this.tr(\"Delete\"), \"@FontAwesome5Solid/trash-alt/16\");\n          this._add(control);\n          break;\n      }\n      return control || this.base(arguments, id);\n    },\n\n    itemSelected: function(selectedItem, isFile) {\n      if (isFile) {\n        this.__selection = selectedItem;\n        this.__selectedLabel.setValue(selectedItem.getFileId());\n      } else {\n        this.__selection = null;\n        this.__selectedLabel.setValue(\"\");\n      }\n    },\n\n    __getItemSelected: function() {\n      let selectedItem = this.__selection;\n      if (selectedItem && qxapp.file.FilesTree.isFile(selectedItem)) {\n        return selectedItem;\n      }\n      return null;\n    },\n\n    // Request to the server an download\n    __retrieveURLAndDownload: function() {\n      let selection = this.__getItemSelected();\n      if (selection) {\n        const fileId = selection.getFileId();\n        let fileName = fileId.split(\"/\");\n        fileName = fileName[fileName.length-1];\n        let dataStore = qxapp.store.Data.getInstance();\n        dataStore.addListenerOnce(\"presignedLink\", e => {\n          const presignedLinkData = e.getData();\n          console.log(presignedLinkData.presignedLink);\n          if (presignedLinkData.presignedLink) {\n            const link = presignedLinkData.presignedLink.link;\n            const fileNameFromLink = qxapp.utils.Utils.fileNameFromPresignedLink(link);\n            fileName = fileNameFromLink ? fileNameFromLink : fileName;\n            qxapp.utils.Utils.downloadLink(link, fileName);\n          }\n        }, this);\n        const download = true;\n        const locationId = selection.getLocation();\n        dataStore.getPresignedLink(download, locationId, fileId);\n      }\n    },\n\n    __deleteFile: function() {\n      let selection = this.__getItemSelected();\n      if (selection) {\n        console.log(\"Delete \", selection);\n        const fileId = selection.getFileId();\n        const locationId = selection.getLocation();\n        if (locationId !== 0 && locationId !== \"0\") {\n          qxapp.component.message.FlashMessenger.getInstance().logAs(this.tr(\"Only files in simcore.s3 can be deleted\"));\n          return false;\n        }\n        let dataStore = qxapp.store.Data.getInstance();\n        dataStore.addListenerOnce(\"deleteFile\", e => {\n          if (e) {\n            this.fireDataEvent(\"fileDeleted\", e.getData());\n          }\n        }, this);\n        return dataStore.deleteFile(locationId, fileId);\n      }\n      return false;\n    }\n  }\n});\n"
  ]
}