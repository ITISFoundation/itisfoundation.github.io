{
  "version": 3,
  "sources": [
    "/home/travis/build/ITISFoundation/osparc-simcore/services/web/client/source/class/qxapp/store/Data.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "core",
    "Object",
    "type",
    "construct",
    "resetCache",
    "events",
    "members",
    "__locationsCached",
    "__datasetsByLocationCached",
    "__filesByLocationAndDatasetCached",
    "getLocationsCached",
    "cache",
    "length",
    "getLocations",
    "cachedData",
    "fireDataEvent",
    "reqLoc",
    "qxapp",
    "io",
    "request",
    "ApiRequest",
    "addListener",
    "eLoc",
    "locations",
    "getTarget",
    "getResponse",
    "data",
    "e",
    "error",
    "console",
    "send",
    "getDatasetsByLocationCached",
    "locationId",
    "location",
    "datasets",
    "getDatasetsByLocation",
    "Permissions",
    "getInstance",
    "canDo",
    "endPoint",
    "reqDatasets",
    "eFiles",
    "getFilesByLocationAndDatasetCached",
    "datasetId",
    "dataset",
    "files",
    "getFilesByLocationAndDataset",
    "reqFiles",
    "getNodeFiles",
    "nodeId",
    "filter",
    "encodeURIComponent",
    "log",
    "getPresignedLink",
    "download",
    "fileUuid",
    "res",
    "method",
    "req",
    "presignedLinkData",
    "presignedLink",
    "copyFile",
    "fromLoc",
    "toLoc",
    "pathId",
    "fileName",
    "split",
    "parameters",
    "component",
    "message",
    "FlashMessenger",
    "logAs",
    "tr",
    "deleteFile",
    "store",
    "Data"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* ************************************************************************\n\n   qxapp - the simcore frontend\n\n   https://osparc.io\n\n   Copyright:\n     2018 IT'IS Foundation, https://itis.swiss\n\n   License:\n     MIT: https://opensource.org/licenses/MIT\n\n   Authors:\n     * Odei Maiz (odeimaiz)\n\n************************************************************************ */\n\n/**\n * Singleton class that is used as entrypoint to the webserver.\n *\n * All data transfer communication goes through the qxapp.store.Store.\n *\n * *Example*\n *\n * Here is a little example of how to use the class.\n *\n * <pre class='javascript'>\n *    const filesStore = qxapp.store.Data.getInstance();\n *    filesStore.addListenerOnce(\"nodeFiles\", e => {\n *      const files = e.getData();\n *      const newChildren = qxapp.data.Converters.fromDSMToVirtualTreeModel(files);\n *      this.__filesToRoot(newChildren);\n *    }, this);\n *    filesStore.getNodeFiles(nodeId);\n * </pre>\n */\n\nqx.Class.define(\"qxapp.store.Data\", {\n  extend: qx.core.Object,\n\n  type : \"singleton\",\n\n  construct: function() {\n    this.resetCache();\n  },\n\n  events: {\n    \"myLocations\": \"qx.event.type.Data\",\n    \"myDatasets\": \"qx.event.type.Data\",\n    \"myDocuments\": \"qx.event.type.Data\",\n    \"nodeFiles\": \"qx.event.type.Data\",\n    \"fileCopied\": \"qx.event.type.Data\",\n    \"deleteFile\": \"qx.event.type.Data\"\n  },\n\n  members: {\n    __locationsCached: null,\n    __datasetsByLocationCached: null,\n    __filesByLocationAndDatasetCached: null,\n\n    resetCache: function() {\n      this.__locationsCached = [];\n      this.__datasetsByLocationCached = {};\n      this.__filesByLocationAndDatasetCached = {};\n    },\n\n    getLocationsCached: function() {\n      const cache = this.__locationsCached;\n      if (cache.length) {\n        return cache;\n      }\n      return null;\n    },\n\n    getLocations: function() {\n      // Get available storage locations\n      const cachedData = this.getLocationsCached();\n      if (cachedData) {\n        this.fireDataEvent(\"myLocations\", cachedData);\n        return;\n      }\n\n      const reqLoc = new qxapp.io.request.ApiRequest(\"/storage/locations\", \"GET\");\n\n      reqLoc.addListener(\"success\", eLoc => {\n        const locations = eLoc.getTarget().getResponse()\n          .data;\n        // Add it to cache\n        this.__locationsCached = locations;\n        this.fireDataEvent(\"myLocations\", locations);\n      }, this);\n\n      reqLoc.addListener(\"fail\", e => {\n        const {\n          error\n        } = e.getTarget().getResponse();\n        this.fireDataEvent(\"myLocations\", []);\n        console.error(\"Failed getting Storage Locations\", error);\n      });\n\n      reqLoc.send();\n    },\n\n    getDatasetsByLocationCached: function(locationId) {\n      const cache = this.__datasetsByLocationCached;\n      if (locationId in cache && cache[locationId].length) {\n        const data = {\n          location: locationId,\n          datasets: cache[locationId]\n        };\n        return data;\n      }\n      return null;\n    },\n\n    getDatasetsByLocation: function(locationId) {\n      // Get list of datasets\n      if (locationId === 1 && !qxapp.data.Permissions.getInstance().canDo(\"storage.datcore.read\")) {\n        return;\n      }\n\n      const cachedData = this.getDatasetsByLocationCached(locationId);\n      if (cachedData) {\n        this.fireDataEvent(\"myDatasets\", cachedData);\n        return;\n      }\n\n      const endPoint = \"/storage/locations/\" + locationId + \"/datasets\";\n      const reqDatasets = new qxapp.io.request.ApiRequest(endPoint, \"GET\");\n\n      reqDatasets.addListener(\"success\", eFiles => {\n        const datasets = eFiles.getTarget().getResponse()\n          .data;\n        const data = {\n          location: locationId,\n          datasets: []\n        };\n        if (datasets && datasets.length>0) {\n          data.datasets = datasets;\n        }\n        // Add it to cache\n        this.__datasetsByLocationCached[locationId] = data.datasets;\n        this.fireDataEvent(\"myDatasets\", data);\n      }, this);\n\n      reqDatasets.addListener(\"fail\", e => {\n        const {\n          error\n        } = e.getTarget().getResponse();\n        const data = {\n          location: locationId,\n          datasets: []\n        };\n        this.fireDataEvent(\"myDatasets\", data);\n        console.error(\"Failed getting Datasets list\", error);\n      });\n\n      reqDatasets.send();\n    },\n\n    getFilesByLocationAndDatasetCached: function(locationId, datasetId) {\n      const cache = this.__filesByLocationAndDatasetCached;\n      if (locationId in cache && datasetId in cache[locationId] && cache[locationId][datasetId].length) {\n        const data = {\n          location: locationId,\n          dataset: datasetId,\n          files: cache[locationId][datasetId]\n        };\n        return data;\n      }\n      return null;\n    },\n\n    getFilesByLocationAndDataset: function(locationId, datasetId) {\n      // Get list of file meta data\n      if (locationId === 1 && !qxapp.data.Permissions.getInstance().canDo(\"storage.datcore.read\")) {\n        return;\n      }\n\n      const cachedData = this.getFilesByLocationAndDatasetCached(locationId, datasetId);\n      if (cachedData) {\n        this.fireDataEvent(\"myDocuments\", cachedData);\n        return;\n      }\n\n      const endPoint = \"/storage/locations/\" + locationId + \"/datasets/\" + datasetId + \"/metadata\";\n      const reqFiles = new qxapp.io.request.ApiRequest(endPoint, \"GET\");\n\n      reqFiles.addListener(\"success\", eFiles => {\n        const files = eFiles.getTarget().getResponse()\n          .data;\n        const data = {\n          location: locationId,\n          dataset: datasetId,\n          files: files && files.length>0 ? files : []\n        };\n        // Add it to cache\n        if (!(locationId in this.__filesByLocationAndDatasetCached)) {\n          this.__filesByLocationAndDatasetCached[locationId] = {};\n        }\n        this.__filesByLocationAndDatasetCached[locationId][datasetId] = data.files;\n        this.fireDataEvent(\"myDocuments\", data);\n      }, this);\n\n      reqFiles.addListener(\"fail\", e => {\n        const {\n          error\n        } = e.getTarget().getResponse();\n        const data = {\n          location: locationId,\n          dataset: datasetId,\n          files: []\n        };\n        this.fireDataEvent(\"myDocuments\", data);\n        console.error(\"Failed getting Files list\", error);\n      });\n\n      reqFiles.send();\n    },\n\n    getNodeFiles: function(nodeId) {\n      const filter = \"?uuid_filter=\" + encodeURIComponent(nodeId);\n      let endPoint = \"/storage/locations/0/files/metadata\";\n      endPoint += filter;\n      let reqFiles = new qxapp.io.request.ApiRequest(endPoint, \"GET\");\n\n      reqFiles.addListener(\"success\", eFiles => {\n        const files = eFiles.getTarget().getResponse()\n          .data;\n        console.log(\"Node Files\", files);\n        if (files && files.length>0) {\n          this.fireDataEvent(\"nodeFiles\", files);\n        }\n        this.fireDataEvent(\"nodeFiles\", []);\n      }, this);\n\n      reqFiles.addListener(\"fail\", e => {\n        const {\n          error\n        } = e.getTarget().getResponse();\n        this.fireDataEvent(\"nodeFiles\", []);\n        console.error(\"Failed getting Node Files list\", error);\n      });\n\n      reqFiles.send();\n    },\n\n    getPresignedLink: function(download = true, locationId, fileUuid) {\n      if (download && !qxapp.data.Permissions.getInstance().canDo(\"study.node.data.pull\", true)) {\n        return;\n      }\n      if (!download && !qxapp.data.Permissions.getInstance().canDo(\"study.node.data.push\", true)) {\n        return;\n      }\n\n      // GET: Returns download link for requested file\n      // POST: Returns upload link or performs copy operation to datcore\n      let res = encodeURIComponent(fileUuid);\n      const endPoint = \"/storage/locations/\" + locationId + \"/files/\" + res;\n      // const endPoint = \"/storage/locations/\" + locationId + \"/files/\" + fileUuid;\n      const method = download ? \"GET\" : \"PUT\";\n      let req = new qxapp.io.request.ApiRequest(endPoint, method);\n\n      req.addListener(\"success\", e => {\n        const {\n          data\n        } = e.getTarget().getResponse();\n        const presignedLinkData = {\n          presignedLink: data,\n          locationId: locationId,\n          fileUuid: fileUuid\n        };\n        console.log(\"presignedLink\", presignedLinkData);\n        this.fireDataEvent(\"presignedLink\", presignedLinkData);\n      }, this);\n\n      req.addListener(\"fail\", e => {\n        const {\n          error\n        } = e.getTarget().getResponse();\n        console.error(\"Failed getting Presigned Link\", error);\n      });\n\n      req.send();\n    },\n\n    copyFile: function(fromLoc, fileUuid, toLoc, pathId) {\n      if (!qxapp.data.Permissions.getInstance().canDo(\"study.node.data.push\", true)) {\n        return false;\n      }\n\n      // \"/v0/locations/1/files/{}?user_id={}&extra_location={}&extra_source={}\".format(quote(datcore_uuid, safe=''),\n      let fileName = fileUuid.split(\"/\");\n      fileName = fileName[fileName.length-1];\n      let endPoint = \"/storage/locations/\"+toLoc+\"/files/\";\n      let parameters = encodeURIComponent(pathId + \"/\" + fileName);\n      parameters += \"?extra_location=\";\n      parameters += fromLoc;\n      parameters += \"&extra_source=\";\n      parameters += encodeURIComponent(fileUuid);\n      endPoint += parameters;\n      let req = new qxapp.io.request.ApiRequest(endPoint, \"PUT\");\n\n      req.addListener(\"success\", e => {\n        const data = {\n          data: e.getTarget().getResponse(),\n          locationId: toLoc,\n          fileUuid: pathId + \"/\" + fileName\n        };\n        this.fireDataEvent(\"fileCopied\", data);\n      }, this);\n\n      req.addListener(\"fail\", e => {\n        const {\n          error\n        } = e.getTarget().getResponse();\n        console.error(error);\n        console.error(\"Failed copying file\", fileUuid, \"to\", pathId);\n        qxapp.component.message.FlashMessenger.getInstance().logAs(this.tr(\"Failed copying file\"), \"ERROR\");\n        this.fireDataEvent(\"fileCopied\", null);\n      });\n\n      req.send();\n\n      return true;\n    },\n\n    deleteFile: function(locationId, fileUuid) {\n      if (!qxapp.data.Permissions.getInstance().canDo(\"study.node.data.delete\", true)) {\n        return false;\n      }\n\n      // Deletes File\n      let parameters = encodeURIComponent(fileUuid);\n      const endPoint = \"/storage/locations/\" + locationId + \"/files/\" + parameters;\n      let req = new qxapp.io.request.ApiRequest(endPoint, \"DELETE\");\n\n      req.addListener(\"success\", e => {\n        const data = {\n          data: e.getTarget().getResponse(),\n          locationId: locationId,\n          fileUuid: fileUuid\n        };\n        this.fireDataEvent(\"deleteFile\", data);\n      }, this);\n\n      req.addListener(\"fail\", e => {\n        const {\n          error\n        } = e.getTarget().getResponse();\n        console.error(\"Failed deleting file\", error);\n        qxapp.component.message.FlashMessenger.getInstance().logAs(this.tr(\"Failed deleting file\"), \"ERROR\");\n        this.fireDataEvent(\"deleteFile\", null);\n      });\n\n      req.send();\n\n      return true;\n    }\n  }\n});\n"
  ]
}